Добро пожаловать в цикл разборов скриптового языка для (G)ZDoom-совместимых портов — ZScript!



## Краткое описание ZScript

Началом истории ZScript можно считать 20 июля 1999, когда сообщество игроков узнало о планах создателя порта ZDoom Randy Heit на включение в порт, которому тогда было чуть больше года, универсального скриптового языка DoomScript, позволивший бы компенсировать недостатки ACS и расширить возможности для создания игровых модификаций. Эта идея послужила мощным толчком к развитию порта, в частности, благодаря ней появился и постепенно обрёл свой нынешний облик язык Decorate. Однако несмотря на обилие возможностей, привнесённых в Decorate за это время, он так и остался языком, основная задача которого — описание внутриигровых взаимодействий между акторами; доступ к другим данным, например, геометрии уровня или меню, с его помощью получить очень трудно. Тем не менее, через многие годы мечты многих разработчиков об удобном универсальном языке наконец воплотились в виде ZScript, о котором дальше и пойдёт речь.

Как язык он появился ещё в версии ZDoom 2.9.1. Тогда он представлял из себя Decorate-подобный набор функций с чуть более расширенными возможностями. Graf Zahl (разработчик GZDoom) подхватил идею и развил её, сильно приблизив и синтаксис, и семантику скрипта к Unreal Engine Script и Java.

### Связь с другими языками для движка Doom

ZScript — вещь крайне мощная; в наиболее известной линейке языков, посвящённых Doom — DeHackEd, ACS, Decorate, ZScript — он наиболее гибок. Технически является сырым [API](https://ru.wikipedia.org/wiki/API) к движку — с почти полной свободой действий в пределах его самого. Функционалом сильно превосходит Decorate и, естественно, DeHackEd. Может почти полностью, за исключением крайне редких специфических случаев, заменить собой ACS. Кстати, неплохой является и их связка — ZScript + ACS — так как из-под любого из них можно вызвать код другого, они прекрасно дополняют друг друга.

Также хотелось бы сразу добавить ответ на довольно популярный вопрос: "Что загружается раньше, Decorate или ZScript"? Ответ — и тот, и другой компилируются в общий байт-код, но ZScript парсится раньше.



## Заметки о синтаксисе

По визуальному представлению ZScript не сильно отличается от ООП-языков вроде C++, C# или Java, так как, собственно, все основные синтаксические его формы взяты с их стандартов. В ZScript нет различия меж строчными и заглавными буквами — регистр букв в коде игнорируется.

### Комментарии

Самая полезная вещь в любом языке программирования — это комментарии. Они будут помогать везде в последующих разборах. Они позволяют прояснить непонятные моменты, временно убрать пока что не особо нужную часть кода, да и просто позволяют вспомнить, что происходит на данном конкретном участке, после возвращения к программе года эдак через два. 

ZScript предоставляет два варианта обозначения комментариев. Оба эти варианта пришли с незапамятных времён — многострочный [со стандарта C89](http://port70.net/~nsz/c/c89/c89-draft.html), однострочный — [с C99](http://port70.net/~nsz/c/c99/n1256.pdf).

```C
// Так будут обозначаться однострочные комментарии (игнорируются препроцессором до конца строки);

/*  Так -- многострочные комментарии (также 
   игнорируются, но по всей длине, до закрывающей 
   последовательности символов). */
```

К слову. Хорошим тоном считается, когда программа (или, в нашем случае, скрипт) самозадокументирована: когда любую логически обособленную часть кода через пару лет сможете понять и Вы сами, и гипотетический психованный маньяк-садист, который знает, где Вы живёте. И тут уже без комментариев не обойтись...

### Операторные скобки

Отметки о границах логического блока. Обозначаются фигурными скобками: "`{`" для начала блока и "`}`" для конца.

### Вывод значений переменных и сообщений

Довольно часто я буду использовать функцию "`console.printf( <здесь_текст> );`" — она выводит указанный текст в консоль \*ZDoom. По умолчанию открывать/закрывать консоль можно по нажатию на тильду ("Ё" на русской раскладке).



## Заключение к введению

По своему опыту и я, и другие люди, разбирающиеся в ZScript, установили, что два лучших способа понять, как работает та или иная функция — это:
1. Посмотреть на примерах в `g-/l-/qzdoom.pk3`; и
2. Взглянуть на [исходный код G-/L-/QZDoom](https://github.com/coelckers/gzdoom/).

Данный цикл статей не сможет и, по задумке автора, не собирается охватывать всё многообразие тем в ZScript. Более того, это вряд ли осуществимо — он довольно часто меняется в мелочах. Впрочем, для большинства задач даже старой версии 3.3.0 должно хватать за глаза и по уши.

Не стоит считать, что информация, хранящаяся внутри \*.pk3 или в исходном коде, не нужна обычному моддеру. Например, исходники незаменимы, если требуется понять значения параметров, которые используются в "нативных" (вшитых напрямую из C++-кода) функциях, или заставить последние работать "неправильно", но так, как нужно Вам.

* * *

Удачи в изучении ZScript!
